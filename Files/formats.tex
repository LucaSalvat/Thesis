

% ---------- Font Dimensions -----------------
\newcommand{\TitleFont}{\fontsize{16}{20}\selectfont}
\newcommand{\SubtitleFont}{\fontsize{14}{18}\selectfont}
\newcommand{\LowerFont}{\fontsize{12}{14.5}\selectfont}



% Front Page ------------

\newcommand{\th@FrontPage}{%
  \ifth@bachelor
    \th@FrontPage@bachelor
  \else\ifth@master
    \th@FrontPage@master
  \else\ifth@phd
    \th@FrontPage@phd
  \else
    \PackageError{thesis}{No degree selected}{Choose bachelor/master/PhD.}%
  \fi\fi\fi
}

% Author Label -----------  Choose the sex of the author

\define@key{general_command}{gender}{%
  \def\temp{#1}%
  \def\female{female}%
  \def\male{male}%
  \ifx\temp\female
    \th@femaletrue
  \else\ifx\temp\male
    \th@femalefalse
  \else
    \PackageError{thesis}{Invalid gender `#1`}{Use gender=male or gender=female}%
  \fi\fi
}

\newcommand{\author@label}{%
  \ifth@female
    \myc@CandidateLabelFemale
  \else
    \myc@CandidateLabel
  \fi
}


% Supervisor & CO-sup labels --------------  plural or singular of supervisor
%\th@supervisor defined in meta

% Supervisor
\newcommand{\th@Supervisor@label}{
    \ifnum\th@supervisorcount>1
        \myc@SupervisorsLabel
    \else
        \myc@SupervisorLabel
    \fi
}

% Co-supervisor
\newcommand{\th@Cosupervisor@label}{%
    \ifnum\th@cosupervisorcount>1
        \myc@CoSupervisorsLabel
    \else
        \myc@CoSupervisorLabel
    \fi
}



% For Each University the Class that must be presented are:
% 1. bachelor
% 2. Master
% 3. PhD

% Input of university format
\InputIfFileExists{Files/formats/\th@uni.tex}{}{%
  \PackageWarning{thesis}{Missing Files/formats/\th@uni.tex; falling back to luiss}%
  \input{Files/formats/luiss.tex}%
}



% General Command -----------------------
\newcommand{\ThesisSettings}[1]{%
  \setkeys{general_command}{#1}%
}

% this command is loaded and must be loaded in all the files
\newcommand{\frontpage}{
	%\begingroup
	%\@twosidefalse
	\th@FrontPage
	\th@SecondPage
	%\endgroup
}


% Second page presentation ---------
\newcommand{\Thesis@Discussion}{%
\myc@ThesisDiscussionBegin \, \th@ExamDate \, \myc@ThesisDiscussionFollowing\linebreak%
\th@ExaminerProfessors
}
\newcommand{\Thesis@NoDiscussion}{\myc@NoDiscussion}


\newcommand{\@ExaminationCommission}{%
\ifth@discussion
    \Thesis@Discussion
\else
    \Thesis@NoDiscussion
\fi
}


\newcommand{\@Copyrigth@Section}{%
\footnotesize
\textbf{\th@title}\linebreak
\copyright~\th@Copyright@Year~\th@candidate\linebreak\linebreak

\myc@copyrights\linebreak\linebreak
%TODO: Add the type of thesis
	
\myc@AuthorCopyright\th@candidate\linebreak
\myc@ContactCopyright \linebreak\linebreak
\myc@AcknowledgmentsCopyrigth
\ignorespacesafterend}



\newcommand{\th@SecondPage}{%
	\thispagestyle{empty}
	\makebox[0.8\textwidth][l]{%
	\parbox{0.8\textwidth}{%
	\raggedright
	\@ExaminationCommission%
	}}
	\vfill
	\noindent\rule{\textwidth}{0.4pt}\vspace{0.03\textheight}
	\makebox[0.8\textwidth][l]{%
	\parbox{0.8\textwidth}{
	\setlength{\parindent}{0pt}
	\raggedright
	\@Copyrigth@Section}}
	\vspace{3.65cm}
}


% ===================== Environment Sections =======================
% --- Safer names (avoid clashing with built-in abstract env) ---
% ===================== Front-matter helper =======================
\newcommand{\thesisfrontchapter}[1]{%
  \cleardoublepage
  \thispagestyle{plain}% typical for front matter openers
  \chapter*{#1}%
  \addcontentsline{toc}{chapter}{#1}%
  \markboth{#1}{#1}% prevents header leakage
}

% ===================== Dedication ===============================
\newcommand{\dedication}[1]{%
  \cleardoublepage
  \thispagestyle{empty}%
  \null\vspace{\stretch{0.26}}%
  \begin{flushright}\textit{#1}\end{flushright}%
  \vspace{\stretch{0.74}}\null
}

% ===================== Abstract (avoid name clash) ===============
\newenvironment{abstractthesis}{%
  \thesisfrontchapter{\myc@AbstractLabel}%
  \noindent\ignorespaces
}{%
  \par\null\ignorespacesafterend
}

\newenvironment{acknowledgements}{%
  \thesisfrontchapter{\myc@AcknowledgmentsLabel}%
  \begingroup
  \pagestyle{acknowledgments}%
  \thispagestyle{plain}%
  \itshape\noindent\ignorespaces
}{%
  \par\null
  \endgroup
  \pagestyle{Thesis}%
  \thispagestyle{acknowledgments}
  %\ignorespacesafterend
}

% ---- Header and Footer Styles -------

\fancypagestyle{Thesis}{% Main Style of Thesis
  \fancyhf{}%
  \if@twoside
    \fancyhead[LE,RO]{\thepage}%
    \fancyhead[RE]{\small\nouppercase{\leftmark}}%
    \fancyhead[OL]{\small\nouppercase{\rightmark}}%
  \else
    \fancyhead[R]{\thepage}%
    \fancyhead[L]{\small\nouppercase{\rightmark}}%
  \fi
  \renewcommand{\headrulewidth}{0.4pt}%
  \renewcommand{\footrulewidth}{0pt}%
}

\fancypagestyle{acknowledgments}{% Acknowledgements style
  \fancyhf{}%
  \if@twoside
    \fancyhead[CE,CO]{\small\nouppercase{\myc@AcknowledgmentsLabel}}%
    \fancyhead[LE,RO]{\thepage}%
  \else
    \fancyhead[C]{\small\nouppercase{\myc@AcknowledgmentsLabel}}%
    \fancyhead[R]{\thepage}%
  \fi
  \renewcommand{\headrulewidth}{0.4pt}%
  \renewcommand{\footrulewidth}{0pt}%
}

\fancypagestyle{plain}{% chapter opening pages
  \fancyhf{}%
  \renewcommand{\headrulewidth}{0pt}%
  \renewcommand{\footrulewidth}{0pt}%
  \fancyhead[LE,RO]{\thepage}%
}

\g@addto@macro\frontmatter{\pagestyle{plain}}
\g@addto@macro\mainmatter{\pagestyle{Thesis}}
\apptocmd{\tableofcontents}{\cleardoublepage\markboth{}{}\markright{}}{}{}

%\pagestyle{Thesis}




