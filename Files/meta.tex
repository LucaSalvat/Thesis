% ----------------------------------------------------------
% 1) STORAGE (defaults are EMPTY so validation is reliable)
% ----------------------------------------------------------

\def\th@title{}
\def\th@subtitle{}
\def\th@candidate{}
\def\th@department{}
\def\th@degree{}
\def\th@chair{}
\def\th@academicyear{}
\def\th@IDNumber{}

% Copyright / contacts
\def\th@Copyright@Year{}
\def\th@ExamDate{}
\def\th@AuthorEmail{}

% Discussion / defense
\def\th@DiscussionDate{}
\def\th@SubmittedDate{} % fixed spelling
\def\th@ExaminerProfessors{}

% ----------------------------------------------------------
% 2) SETTERS (user API)
% ----------------------------------------------------------

\newcommand{\thtitle}[1]{\gdef\th@title{#1}}
\newcommand{\thsubtitle}[1]{\gdef\th@subtitle{#1}}
\newcommand{\candidate}[1]{\gdef\th@candidate{#1}}
\newcommand{\department}[1]{\gdef\th@department{#1}}
\newcommand{\degree}[1]{\gdef\th@degree{#1}}
\newcommand{\chair}[1]{\gdef\th@chair{#1}}
\newcommand{\academicyear}[1]{\gdef\th@academicyear{#1}}
\newcommand{\idnumber}[1]{\gdef\th@IDNumber{#1}}

\newcommand{\copyyear}[1]{\gdef\th@Copyright@Year{#1}}
\newcommand{\examdate}[1]{\gdef\th@ExamDate{#1}}
\newcommand{\authoremail}[1]{\gdef\th@AuthorEmail{#1}}

\newcommand{\discussiondate}[1]{\gdef\th@DiscussionDate{#1}}
\newcommand{\submitteddate}[1]{\gdef\th@SubmittedDate{#1}} % fixed, new canonical name
\newcommand{\examiner}[1]{\gdef\th@ExaminerProfessors{#1}}

% Backward-compatible typo alias (optional)
\newcommand{\sumbimttedsate}[1]{\submitteddate{#1}} % keep old misspelling working

% ----------------------------------------------------------
% 3) SUPERVISORS / CO-SUPERVISORS (list logic)
%    Store empty by default; build a line-broken list.
% ----------------------------------------------------------

\newcount\th@supervisorcount
\th@supervisorcount=0
\gdef\th@supervisors{}%

\newcommand{\th@reset@supervisors}{%
  \gdef\th@supervisors{}%
  \th@supervisorcount=0\relax
}
\newcommand{\AddSupervisor}[1]{%
  \advance\th@supervisorcount by 1\relax
  \ifnum\th@supervisorcount=1
    \gdef\th@supervisors{#1}%
  \else
    \g@addto@macro\th@supervisors{\\#1}%
  \fi
}
\newcommand{\supervisor}[1]{%
  \th@reset@supervisors
  \AddSupervisor{#1}%
}
\newcommand{\supervisors}[1]{%
  \th@reset@supervisors
  \gdef\th@supervisors{#1}%
  \advance\th@supervisorcount by 1\relax
}

\newcount\th@cosupervisorcount
\th@cosupervisorcount=0
\gdef\th@cosupervisors{}%

\newcommand{\th@reset@cosupervisors}{%
  \gdef\th@cosupervisors{}%
  \th@cosupervisorcount=0\relax
}
\newcommand{\AddCoSupervisor}[1]{%
  \advance\th@cosupervisorcount by 1\relax
  \ifnum\th@cosupervisorcount=1
    \gdef\th@cosupervisors{#1}%
  \else
    \g@addto@macro\th@cosupervisors{\\#1}%
  \fi
}
\newcommand{\cosupervisor}[1]{%
  \th@reset@cosupervisors
  \AddCoSupervisor{#1}%
}
\newcommand{\cosupervisors}[1]{%
  \th@reset@cosupervisors
  \gdef\th@cosupervisors{#1}%
  \advance\th@cosupervisorcount by 1\relax
}

% Case-friendly aliases (optional)
\newcommand{\ThesisTitle}[1]{\thtitle{#1}}
\newcommand{\ThesisSubtitle}[1]{\thsubtitle{#1}}
\newcommand{\Candidate}[1]{\candidate{#1}}
\newcommand{\Department}[1]{\department{#1}}
\newcommand{\Degree}[1]{\degree{#1}}
\newcommand{\Chair}[1]{\chair{#1}}
\newcommand{\AcademicYear}[1]{\academicyear{#1}}
\newcommand{\IDnumber}[1]{\idnumber{#1}}
\newcommand{\Supervisor}[1]{\supervisor{#1}}
\newcommand{\Supervisors}[1]{\supervisors{#1}}
\newcommand{\CoSupervisor}[1]{\cosupervisor{#1}}
\newcommand{\CoSupervisors}[1]{\cosupervisors{#1}}


% ----------------------------------------------------------
% 3) Gender Case (list logic)
% ----------------------------------------------------------

\newif\ifth@female
\th@femalefalse

% map table
\def\th@gender@female{female}
\def\th@gender@f{female}
\def\th@gender@male{male}
\def\th@gender@m{male}

\newcommand{\th@setgender}[1]{%
  \edef\th@tmp{\zap@space#1 \@empty}%
  \lowercase{\edef\th@tmp{\th@tmp}}%
  \@ifundefined{th@gender@\th@tmp}{%
    \ClassError{thesis}{Invalid gender `#1`}%
      {Use male/female (also accepted: m/f).}%
  }{%
    \edef\th@tmp{\csname th@gender@\th@tmp\endcsname}%
    \def\th@cmp{female}%
    \ifx\th@tmp\th@cmp \th@femaletrue \else \th@femalefalse \fi
  }%
}

\newcommand{\gender}[1]{\th@setgender{#1}}

% ----------- Option for a single key command ---------------
\define@key{thesis}{title}{\thtitle{#1}}
\define@key{thesis}{subtitle}{\thsubtitle{#1}}
\define@key{thesis}{candidate}{\candidate{#1}}
\define@key{thesis}{department}{\department{#1}}
\define@key{thesis}{degree}{\degree{#1}}
\define@key{thesis}{chair}{\chair{#1}}
\define@key{thesis}{academicyear}{\academicyear{#1}}
\define@key{thesis}{idnumber}{\idnumber{#1}}

\define@key{thesis}{copyyear}{\copyyear{#1}}
\define@key{thesis}{examdate}{\examdate{#1}}
\define@key{thesis}{authoremail}{\authoremail{#1}}

\define@key{thesis}{discussiondate}{\discussiondate{#1}}
\define@key{thesis}{submitteddate}{\submitteddate{#1}}
\define@key{thesis}{examiner}{\examiner{#1}}

% Comma-separated lists (simple approach)
\define@key{thesis}{supervisors}{%
  \th@reset@supervisors
  \@for\th@tmp:=#1\do{\AddSupervisor{\th@tmp}}%
}
\define@key{thesis}{cosupervisors}{%
  \th@reset@cosupervisors
  \@for\th@tmp:=#1\do{\AddCoSupervisor{\th@tmp}}%
}

% Gender defition 
\define@key{thesis}{gender}{\th@setgender{#1}}

% General command to call for the option ---------
\newcommand{\thesissetup}[1]{%
  \setkeys{thesis}{#1}%
}


%------------------------------------------------------
% -------- Error Cheks for entries --------------------
%------------------------------------------------------

\newcommand{\th@error}[2]{%
  \ClassError{thesis}{#1}{#2}%
}

% Required field checker: field macro + how to set it
\newcommand{\th@require}[2]{%
  \ifdefempty{#1}{%
    \th@error
      {Missing required thesis metadata: \string#1}%
      {You must define it in the preamble.\MessageBreak
       Example: #2}%
  }{}%
}

% Conditional checker: only if a boolean is true
% Usage: \th@require@if{\ifth@discussion}{\th@DiscussionDate}{\discussiondate{...}}
\newcommand{\th@require@if}[3]{%
  #1%
    \th@require{#2}{#3}%
  \fi
}



\newcommand{\th@check@metadata}{%
  % ---- Always required (edit to match your university) ----
  \th@require{\th@title}{\thtitle{My Thesis Title}}%
  \th@require{\th@candidate}{\candidate{Your Name}}%
  \th@require{\th@degree}{\degree{Degree name}}%
  \th@require{\th@academicyear}{\academicyear{20XX-20XX}}%

  % Supervisors: if you want at least one supervisor required
  \th@require{\th@supervisors}{\supervisor{Prof. Name}}%
  
  % In case the thesis is a master thesis
  %\th@requireif{\ifth@PhD}{}

  % ---- Conditional: only if discussion option is enabled ----
  \th@require@if{\ifth@discussion}{\th@DiscussionDate}{\discussiondate{29 October 2026}}%
  \th@require@if{\ifth@discussion}{\th@ExaminerProfessors}{\examiner{Prof. A\\Prof. B}}%
  
  
  % ----- Mandatory entries for Luiss Front Page ---------
  %\th@requireif{\if\th@uni
}

\AtBeginDocument{%
  \th@check@metadata
}


